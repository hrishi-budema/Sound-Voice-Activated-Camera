% Voice-Activated Camera â€” Project Report (U. Basel)
% IMPORTANT: Compile with Biber (not BibTeX).

\documentclass[11pt,a4paper]{article}

\usepackage[a4paper,margin=2.2cm]{geometry}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{lmodern}
\usepackage{microtype}
\usepackage{graphicx}
\usepackage{float}
\usepackage{booktabs}
\usepackage{hyperref}
\usepackage{enumitem}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{amsmath}

% ---------------- Bibliography (BibLaTeX) ----------------
\usepackage[
  backend=biber,
  style=ieee,
  sorting=none
]{biblatex}

% Load BOTH .bib files (so citations in the text resolve)
\addbibresource{CA_project.bib}
\addbibresource{CA_project_code.bib}

\hypersetup{
  colorlinks=true,
  linkcolor=blue,
  urlcolor=blue,
  citecolor=blue
}

\setlist[itemize]{noitemsep, topsep=2pt}

\title{\textbf{Voice-Activated Camera}\\
\vspace{4pt}
\large Fall Semester, 2025\\
Computer Architecture\\
University Basel}
\author{
Constantin Jessner \and Hrishi Budema \and Kemal Y\"{o}net
}
\date{January 20, 2026}

\begin{document}
\maketitle

\vspace{-6mm}

\begin{figure}[h]
    \centering
    \includegraphics[width=0.99\textwidth]{images/projectimage.jpeg}
    \caption{Complete hardware setup of the Voice-Activated Camera system.}
    \label{fig:setup}
\end{figure}
\begin{abstract}
This project presents the design and implementation of a sound-activated camera system based on an Arduino Uno and an ESP32-CAM module. The goal of the project was to reliably capture and store images on a microSD card when a predefined acoustic event occurs, while ensuring safe and stable communication between heterogeneous hardware components.

An Arduino Uno is used to monitor a KY-037 sound sensor and to detect a double-clap event within a configurable timing window. Upon a valid trigger, the Arduino generates a clean, level-shifted digital pulse to the ESP32-CAM. The ESP32-CAM then captures a JPEG image using its onboard OV2640 camera and stores it on an SD card via the SD\_MMC interface. To improve robustness, debouncing, timing constraints, and a lockout period were implemented to reduce false positives. Hardware-level challenges such as voltage level mismatches and power stability during image capture were addressed using a resistive voltage divider and a stable external power supply.

The final system successfully captures and stores a new image for each valid double-clap event under stable power conditions. Experimental evaluation confirmed reliable triggering, correct file generation, and consistent image storage, demonstrating that the system meets its original design goals and can be reproduced using the provided hardware configuration and software.
\end{abstract}
% ===================== 1) INTRODUCTION =====================
\section{Introduction}
The Voice-Activated Camera is a system that captures an image when a loud sound, such as a clap, is detected. A KY-037 sound sensor produces a digital trigger signal that is processed by an Arduino Uno and forwarded to an ESP32-CAM module. The ESP32-CAM captures a JPEG image using its OV2640 camera and stores it on a microSD card. An LED provides visual feedback, and the camera is mounted on stepper motors to allow basic rotational movement while idle.

The system is triggered by sound intensity rather than speech; therefore, it technically operates as a sound-activated camera.

The design accounts for ESP32 GPIO constraints and boot-mode behavior based on ESP32 pinout documentation \cite{noauthor_esp32_2022}. Image capture and SD-card storage follow established ESP32-CAM workflows from community-supported examples \cite{theinfoflux_unlocking_2024}. Reference material was also consulted for integrating the 74HC595 shift register \cite{noauthor_using_nodate,ee_wave_74hc595_2022}.


\subsection*{Contributions}
\begin{itemize}
  \item Implemented a double-clap trigger within a configurable timing window (e.g., 200\,ms) to reduce false positives.
  \item Integrated Arduino-based trigger generation with ESP32-CAM image capture and SD-card storage.
  \item Designed safe hardware interfacing (voltage divider/level shifting and common-ground wiring).
  \item Implemented visible feedback (Arduino LEDs and ESP32-CAM flash) to confirm trigger and capture.
  \item Verified end-to-end functionality through repeated trials and documented a reproducible setup using Fritzing 
\end{itemize}

% ===================== 2) METHODOLOGY / APPROACH =====================
\section{Methodology and System Design}
The system uses two microcontrollers with distinct roles. An Arduino Uno handles sound sensing and double-clap detection with debouncing, controls the servo motors, and generates a trigger signal. The ESP32-CAM receives this trigger, captures a JPEG image using its OV2640 camera, and stores it on a microSD card.

\section{Implementation}
Focus on key engineering decisions, not a timeline.

\subsection{Circuit Design}
For the circuit design we used Fritzing software because Tinkercad did not have all the components we needed. For example, Tinkercad does not provide an ESP32-CAM, which is a critical component of the project. Fritzing also allowed us to accurately represent the ESP32-CAM pinout and external connections, which is important given the module's GPIO constraints and boot-mode behavior \cite{noauthor_esp32_2022}.

\noindent\textbf{Project Repository:} \href{https://github.com/hrishi-budema/Sound-Voice-Activated-Camera/blob/main/images/AllComponentsCleaned_schem.pdf}{Hardware schema}

\begin{figure}[h]
    \centering
    \includegraphics[width=0.6\textwidth]{images/wholeproject.png}
    \caption{Complete hardware setup of the Voice-Activated Camera system.}
    \label{fig:wholeproject}
\end{figure}

\subsection{Double-Clap Detection and False Positive Reduction}
The KY-037 module provides a digital output (D0) that goes HIGH when the microphone signal exceeds an adjustable threshold. We implemented rising-edge detection on this signal and added a time-based debounce (\texttt{debounceMs}) to ignore very short toggles caused by sensor noise. To reduce false positives, we used a double-clap trigger: after a first detected clap, the system waits for a second clap within \texttt{doubleClapMs}. If the second clap does not arrive in time, the event is discarded. This approach significantly reduces accidental triggers caused by random loud sounds.


In our final configuration, the double-clap window was set to 200\,ms (as suggested in the feedback). We also added a lockout time after a valid trigger to prevent repeated triggers from echoes or continued noise.
\noindent\textbf{Project Repository:} \href{https://github.com/hrishi-budema/Sound-Voice-Activated-Camera/blob/main/arduino.ino}{arduino.ino}

\subsection{Reliable Triggering Between Arduino and ESP32-CAM}
A key challenge was achieving reliable triggering of the ESP32-CAM without missed events. The ESP32-CAM firmware is edge-sensitive in the sense that it must observe a LOW state before reacting to a new HIGH. Therefore, the Arduino generates a trigger pulse with two phases: (i) a HIGH phase (\texttt{espPulseMs}) and (ii) a forced LOW phase (\texttt{espGapMs}). This guarantees a clean re-arming condition on the ESP32-CAM input even if the Arduino-side event detection is noisy.

Additionally, the Arduino-to-ESP32 trigger line is level-shifted using a resistive divider to avoid applying 5\,V directly to a 3.3\,V input. This protected the ESP32-CAM and improved stability over long test runs.

\begin{figure}[h]
    \centering
    \includegraphics[width=0.99\textwidth]{images/espconnections.png}
    \caption{ESP32-CAM wiring and trigger connections.}
    \label{fig:espconnections}
\end{figure}

\begin{figure}[h]
    \centering
    \includegraphics[width=0.5\textwidth]{images/circuit.png}
    \caption{Voltage divider used for Arduino-to-ESP32 trigger level shifting.}
    \label{fig:voltagedivider}
\end{figure}

To safely connect the Arduino digital output (D4) to the ESP32-CAM RX pin (GPIO3), a voltage divider is used. The Arduino outputs 5\,V logic, while the ESP32-CAM RX pin operates at 3.3\,V. Sending 5\,V directly could damage the ESP32-CAM. The voltage divider reduces the voltage as follows:

\[
V_\text{RX} = V_\text{in} \times \frac{R_2}{R_1 + R_2}
\]

Where:
\[
R_1 = 1\,\text{k}\Omega \quad \text{(from Arduino D4 to ESP32 RX)}
\]
\[
R_2 = 2\,\text{k}\Omega \quad \text{(from ESP32 RX to GND)}
\]
\[
V_\text{in} = 5\,\text{V (Arduino output)}
\]

Substituting the values:

\[
V_\text{RX} = 5 \times \frac{2}{1 + 2} = 5 \times \frac{2}{3} \approx 3.33\,\text{V}
\]

This ensures that when Arduino D4 outputs a HIGH signal (5\,V), the ESP32-CAM RX pin receives approximately 3.3\,V, which is within safe operating limits. A LOW signal from the Arduino (0\,V) remains 0\,V at the RX pin.

\subsection{Image Capture and SD Card Storage}
On the ESP32-CAM, the camera is configured for JPEG capture (OV2640) and images are written to the SD card using the SD\_MMC interface \cite{espressif_esp32_camera}. Filenames are generated by incrementing a stored counter in non-volatile memory (\texttt{Preferences}), producing a sequence such as \texttt{PIC0001.jpg}, \texttt{PIC0002.jpg}, etc. This avoids overwriting old images and supports repeated experiments.

For stability, we used SD\_MMC in 1-bit mode, which is generally more tolerant of wiring and timing than 4-bit mode on ESP32-CAM modules \cite{theinfoflux_unlocking_2024}. During evaluation we observed that SD writing is sensitive to power stability, especially during flash usage and high-resolution captures. Ensuring a stable 5\,V supply and short, low-resistance wiring reduced the probability of corrupted or empty files.

\begin{figure}[h]
    \centering
    \begin{subfigure}[b]{0.2\textwidth}
        \centering
        \includegraphics[width=\textwidth]{images/whiteimage.jpg}
    \end{subfigure}%
    \hspace{2mm}
    \begin{subfigure}[b]{0.2\textwidth}
        \centering
        \includegraphics[width=\textwidth]{images/greenimage.jpg}
    \end{subfigure}
    \caption{Images taken consecutively on the ESP32-CAM.}
    \label{fig:side_by_side}
\end{figure}

The occasional green image is most likely caused by the camera's automatic white balance or exposure not fully stabilizing on the first frame after initialization.

% ===================== 4) EVALUATION =====================
\section{Evaluation}
\subsection{Functional Evaluation}
We evaluated the system by repeatedly triggering the camera using a double clap and verifying that (i) the ESP32-CAM flash activated, (ii) a new JPEG file was created on the SD card, and (iii) the stored file had non-zero size and could be opened on a PC. Over multiple trials, the system reliably produced a new image file for each valid double-clap event, provided that the power supply was stable and the trigger line remained properly level-shifted. False positives were reduced by the double-clap window and lockout time; random background sounds rarely satisfied the two-clap timing requirement.

\subsection{Performance and Limitations}
In practice, the system was more reliably triggered by slower, louder claps than by very fast and sharp claps. Even with a 200\,ms double-clap window, a trigger only occurs if each clap produces a clear HIGH signal at the sound sensor output. Short, high-pitched claps can be too brief to cross the detection threshold or may be filtered out by the debounce logic. This results in a trade-off where false triggers are reduced, but some valid fast claps are not detected.

% ===================== 5) CONCLUSION + OUTLOOK =====================
\section{Conclusions and Outlook}
We successfully built a sound-activated (double-clap) camera system that captures and stores images on an SD card using an ESP32-CAM, with an Arduino Uno performing reliable trigger detection and mechanical motion control. The final system demonstrates robust event detection via a two-clap timing window and safe, reproducible interfacing between 5\,V and 3.3\,V logic domains. The main engineering lessons were the importance of debouncing and timing constraints for reliable triggers, and the importance of stable power delivery for camera capture and SD writing.

\subsection{Division of Labor}
\begin{itemize}
  \item \textbf{Constantin Jessner}: hardware wiring, level shifting, power tests
  \item \textbf{Hrishi Budema}: Arduino clap detection + servo logic
  \item \textbf{Kemal Y\"{o}net}: ESP32-CAM capture + SD storage
\end{itemize}

\subsection{Critical Self-Assessment}
Next time, we would focus on adding object detection so the camera could follow an object or detect anomalies, rather than just taking pictures when it hears a sound. We would also use a proper ESP32-CAM stand instead of cardboard to make the setup look more professional. Soldering the connections would prevent wires from coming loose when the camera moves. Finally, we would spend more time refining the code to make the system more reliable.

% ===================== INTEGRITY / AI DISCLAIMER =====================
\section*{Scientific Integrity Declaration}
We confirm that this report is our own work. We used external sources only as cited in the references. We used AI tools (e.g., ChatGPT) for language improvements and code review support; we verified all technical content and experimental claims ourselves.

\subsection{Code Developed for This Project}
\noindent\textbf{Project Repository:} \href{https://github.com/hrishi-budema/Sound-Voice-Activated-Camera}{Project Repo}

% ===================== REFERENCES =====================
\newpage

\section*{Documentation and Hardware References}
\begin{refsection}[CA_project.bib]
  \nocite{*}
  \printbibliography
\end{refsection}

\section*{Code and Implementation References}
\begin{refsection}[CA_project_code.bib]
  \nocite{*}
  \printbibliography
\end{refsection}

\end{document}
